<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Manage Vaccine Centers</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">

	<link rel="stylesheet" href="../../static/css/open-iconic-bootstrap.min.css">
	<link rel="stylesheet" href="../../static/css/animate.css">

	<link rel="stylesheet" href="../../static/css/owl.carousel.min.css">
	<link rel="stylesheet" href="../../static/css/owl.theme.default.min.css">
	<link rel="stylesheet" href="../../static/css/magnific-popup.css">

	<link rel="stylesheet" href="../../static/css/aos.css">

	<link rel="stylesheet" href="../../static/css/ionicons.min.css">

	<link rel="stylesheet" href="../../static/css/flaticon.css">
	<link rel="stylesheet" href="../../static/css/icomoon.css">
	<link rel="stylesheet" href="../../static/css/style.css">


	<!-- Table Style -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<style>
		body {
            color: #566787;
            background: #f5f5f5;
            font-family: 'Varela Round', sans-serif;
            font-size: 13px;
        }
        .table-responsive {
            margin: 30px 0;
        }
        .table-wrapper {
            min-width: 1000px;
            background: #fff;
            padding: 20px 25px;
            border-radius: 3px;
            box-shadow: 0 1px 1px rgba(0,0,0,.05);
        }
        .table-title {
            padding-bottom: 15px;
            background: #435d7d;
            color: #fff;
            padding: 16px 30px;
            margin: -20px -25px 10px;
            border-radius: 3px 3px 0 0;
        }
        .table-title h2 {
            margin: 5px 0 0;
            font-size: 24px;
        }
        .table-title .btn-group {
            float: right;
        }
        .table-title .btn {
            color: #fff;
            float: right;
            font-size: 13px;
            border: none;
            min-width: 50px;
            border-radius: 2px;
            border: none;
            outline: none !important;
            margin-left: 10px;
        }
        .table-title .btn i {
            float: left;
            font-size: 21px;
            margin-right: 5px;
        }
        .table-title .btn span {
            float: left;
            margin-top: 2px;
        }
        table.table tr th, table.table tr td {
            border-color: #e9e9e9;
            padding: 12px 15px;
            vertical-align: middle;
        }
        /* table.table tr th:first-child {
            width: 60px;
        } */
        table.table tr th:last-child {
            width: 100px;
        }
        table.table-striped tbody tr:nth-of-type(odd) {
            background-color: #fcfcfc;
        }
        table.table-striped.table-hover tbody tr:hover {
            background: #f5f5f5;
        }
        table.table th i {
            font-size: 13px;
            margin: 0 5px;
            cursor: pointer;
        }
        table.table td:last-child i {
            opacity: 0.9;
            font-size: 22px;
            margin: 0 5px;
        }
        table.table td a {
            font-weight: bold;
            color: #566787;
            display: inline-block;
            text-decoration: none;
            outline: none !important;
        }
        table.table td a:hover {
            color: #2196F3;
        }
        table.table td a.edit {
            color: #FFC107;
        }
        table.table td a.delete {
            color: #F44336;
        }
        table.table td i {
            font-size: 19px;
        }
        table.table .avatar {
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 10px;
        }
        .pagination {
            float: right;
            margin: 0 0 5px;
        }
        .pagination li a {
            border: none;
            font-size: 13px;
            min-width: 30px;
            min-height: 30px;
            color: #999;
            margin: 0 2px;
            line-height: 30px;
            border-radius: 2px !important;
            text-align: center;
            padding: 0 6px;
        }
        .pagination li a:hover {
            color: #666;
        }
        .pagination li.active a, .pagination li.active a.page-link {
            background: #03A9F4;
        }
        .pagination li.active a:hover {
            background: #0397d6;
        }
        .pagination li.disabled i {
            color: #ccc;
        }
        .pagination li i {
            font-size: 16px;
            padding-top: 6px
        }
        .hint-text {
            float: left;
            margin-top: 10px;
            font-size: 13px;
        }
        /* Custom checkbox */
        .custom-checkbox {
            position: relative;
        }
        .custom-checkbox input[type="checkbox"] {
            opacity: 0;
            position: absolute;
            margin: 5px 0 0 3px;
            z-index: 9;
        }
        .custom-checkbox label:before{
            width: 18px;
            height: 18px;
        }
        .custom-checkbox label:before {
            content: '';
            margin-right: 10px;
            display: inline-block;
            vertical-align: text-top;
            background: white;
            border: 1px solid #bbb;
            border-radius: 2px;
            box-sizing: border-box;
            z-index: 2;
        }
        .custom-checkbox input[type="checkbox"]:checked + label:after {
            content: '';
            position: absolute;
            left: 6px;
            top: 3px;
            width: 6px;
            height: 11px;
            border: solid #000;
            border-width: 0 3px 3px 0;
            transform: inherit;
            z-index: 3;
            transform: rotateZ(45deg);
        }
        .custom-checkbox input[type="checkbox"]:checked + label:before {
            border-color: #03A9F4;
            background: #03A9F4;
        }
        .custom-checkbox input[type="checkbox"]:checked + label:after {
            border-color: #fff;
        }
        .custom-checkbox input[type="checkbox"]:disabled + label:before {
            color: #b8b8b8;
            cursor: auto;
            box-shadow: none;
            background: #ddd;
        }
        /* Modal styles */
        .modal .modal-dialog {
            max-width: 400px;
        }
        .modal .modal-header, .modal .modal-body, .modal .modal-footer {
            padding: 20px 30px;
        }
        .modal .modal-content {
            border-radius: 3px;
        }
        .modal .modal-footer {
            background: #ecf0f1;
            border-radius: 0 0 3px 3px;
        }
        .modal .modal-title {
            display: inline-block;
        }
        .modal .form-control {
            border-radius: 2px;
            box-shadow: none;
            border-color: #dddddd;
        }
        .modal textarea.form-control {
            resize: vertical;
        }
        .modal .btn {
            border-radius: 2px;
            min-width: 100px;
        }
        .modal form label {
            font-weight: normal;
        }
	</style>
</head>


<body data-spy="scroll" data-target=".site-navbar-target" data-offset="300">
<div class="py-1 bg-black top">
	<div class="container">
		<div class="row no-gutters d-flex align-items-start align-items-center px-md-0">
			<div class="col-lg-12 d-block">
				<div class="row d-flex">
					<div class="col-md pr-4 d-flex topper align-items-center">
						<div class="icon mr-2 d-flex justify-content-center align-items-center"><span
								class="icon-phone2"></span></div>
						<span class="text">+ 1235 2355 98</span>
					</div>
					<div class="col-md pr-4 d-flex topper align-items-center">
						<div class="icon mr-2 d-flex justify-content-center align-items-center"><span
								class="icon-paper-plane"></span></div>
						<span class="text">Vax1234@gmail.com</span>
					</div>
					<div class="col-md-5 pr-4 d-flex topper align-items-center text-lg-right justify-content-end">
						<p class="mb-0 register-link"><a href="../login.html" class="mr-3">LogIN</a><a
								href="#">Log Out</a>
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light site-navbar-target"
	 id="ftco-navbar">
	<div class="container">
		<a class="navbar-brand" href="index.html">VaxSchedular</a>
		<button class="navbar-toggler js-fh5co-nav-toggle fh5co-nav-toggle" type="button" data-toggle="collapse"
				data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="oi oi-menu"></span> Menu
		</button>

		<div class="collapse navbar-collapse" id="ftco-nav">
			<ul class="navbar-nav nav ml-auto">
				<li class="nav-item"><a href="index.html" class="nav-link"><span>Home</span></a></li>
				<li class="nav-item"><a href="index.html#about-section" class="nav-link"><span>About</span></a></li>
				<li class="nav-item"><a href="index.html#doctor-section" class="nav-link"><span>Centers</span></a>
				</li>
				<li class="nav-item"><a href="vaccineDetails.html" class="nav-link"><span>Vaccines</span></a></li>
				<li class="nav-item"><a href="index.html#contact-section" class="nav-link"><span>Contact</span></a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
					   data-toggle="dropdown"
					   aria-haspopup="true" aria-expanded="false">
						Admin Options
					</a>
					<div class="dropdown-menu" aria-labelledby="navbarDropdown">
						<a class="dropdown-item" href="ADMINmanageVaccineCenter.html"> Vaccine Centers</a>
						<a class="dropdown-item" href="ADMINmanageVaccine.html"> Vaccine Types</a>
						<a class="dropdown-item" href="patientHistory.html"> Patient History</a>
					</div>
				</li>
			</ul>
		</div>
	</div>
</nav>


<!-- Table -->
<div class="table" style="padding-top: 150px;">
	<div class="container">
		<div class="table-responsive">
			<div class="table-wrapper">
				<div class="table-title">
					<div class="row">
						<div style="padding-right: 720px;" class="col-xs-6">
							<h2>Manage <b>Vaccine Centers</b></h2>
						</div>
						<div style=" padding-top: 5px; padding-left: 150px;" class="col-xs-6">
							<a href="#addEmployeeModal" class="btn btn-success" data-toggle="modal"><i
									class="material-icons">&#xE147;</i> <span>Add Center</span></a>
						</div>
					</div>
				</div>
				<table class="table table-striped table-hover">
					<thead>
					<tr>
						<th>Center ID</th>
						<th>Center Name</th>
						<th>Vaccine Type</th>
						<th>Address</th>
						<th>Contact Info</th>
						<th>Actions</th>
					</tr>
					</thead>
					<tbody id="tableBody">
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<!-- Edit Modal HTML -->
	<div id="addEmployeeModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form id="addCenterForm">
					<div class="modal-header">
						<h4 class="modal-title">Add Center</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="centerName">Center Name</label>
							<input type="text" class="form-control" id="centerName" required>
						</div>
						<div class="form-group">
							<label for="vaccineType">Vaccine Type</label>
							<input type="text" class="form-control" id="vaccineType" required>
						</div>
						<div class="form-group">
							<label for="address">Address</label>
							<input type="text" class="form-control" id="address" required>
						</div>
						<div class="form-group">
							<label for="contactInfo">Contact Info</label>
							<input type="text" class="form-control" id="contactInfo" required>
						</div>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input type="submit" class="btn btn-success" value="Add">
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- Edit Modal HTML -->
	<div id="editCenterModal" class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<form>
					<div class="modal-header">
						<h4 class="modal-title">Edit Center</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label>Center ID</label>
							<input type="text" class="form-control" id="editCenterId" disabled>
							<input type="hidden" id="centerId" name="centerId">
						</div>
						<div class="form-group">
							<label>Center Name</label>
							<input type="text" id="editCenterName" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Vaccine Type</label>
							<input type="text" id="editVaccineType" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Address</label>
							<input type="text" id="editAddress" class="form-control" required>
						</div>
						<div class="form-group">
							<label>Contact Info</label>
							<input id="editContactInfo" type="text" class="form-control" required>
						</div>
					</div>
					<div class="modal-footer">
						<input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
						<input  id="editCenterForm" type="submit" class="btn btn-info" value="Save">
					</div>
				</form>
			</div>
		</div>
	</div>
	
</div>
<!-- End of Table -->

<footer class="ftco-footer ftco-section img" style="background-image: url(images/footer-bg.jpg);">
	<div class="overlay"></div>
	<div class="container-fluid px-md-5">
		<div class="row mb-5">
			<div class="col-md">
				<div class="ftco-footer-widget mb-4">
					<h2 class="ftco-heading-2">VaxSchedular</h2>
					<p>Find convenience and reliability at our Trusted Vaccines Centers.</p>
					<ul class="ftco-footer-social list-unstyled mt-5">
						<li class="ftco-animate"><a href="#"><span class="icon-twitter"></span></a></li>
						<li class="ftco-animate"><a href="#"><span class="icon-facebook"></span></a></li>
						<li class="ftco-animate"><a href="#"><span class="icon-instagram"></span></a></li>
					</ul>
				</div>
			</div>
			<div class="col-md">
				<div class="ftco-footer-widget mb-4 ml-md-4">
					<h2 class="ftco-heading-2">Links</h2>
					<ul class="list-unstyled">
						<li><a href="../index.html"><span class="icon-long-arrow-right mr-2"></span>Home</a></li>
						<li><a href="../index.html#about-section"><span class="icon-long-arrow-right mr-2"></span>About</a>
						</li>
						<li><a href="../index.html#doctor-section"><span class="icon-long-arrow-right mr-2"></span>Centers</a>
						</li>
						<li><a href="../vaccineDetails.html"><span
								class="icon-long-arrow-right mr-2"></span>Vaccines</a></li>
						<li><a href="../index.html#contact-section"><span class="icon-long-arrow-right mr-2"></span>Contact</a>
						</li>
					</ul>
				</div>
			</div>
			<div class="col-md">
				<div class="ftco-footer-widget mb-4">
					<h2 class="ftco-heading-2">Have a Questions?</h2>
					<div class="block-23 mb-3">
						<ul>
							<li><span class="icon icon-map-marker"></span><span class="text">El tahreer square ,
										Cairo
									</span></li>
							<li><a href="#"><span class="icon icon-phone"></span><span class="text">+2 392 3929
											210</span></a></li>
							<li><a href="#"><span class="icon icon-envelope pr-4"></span><span
									class="text">vax1234@gmail.com</span></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 text-center">

				<p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
					Copyright &copy;
					<script>document.write(new Date().getFullYear());</script>
					All rights reserved <i
							class="icon-heart color-danger" aria-hidden="true"></i> by <a href="https://colorlib.com"target="_blank">
						|VaxSchedular</a>
					<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
				</p>
			</div>
		</div>
	</div>
</footer>


<!-- loader -->
<div id="ftco-loader" class="show fullscreen">
	<svg class="circular" width="48px" height="48px">
		<circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
		<circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
				stroke="#F96D00"/>
	</svg>
</div>

<script src="../../static/js/jquery.min.js"></script>
<script src="../../static/js/jquery-migrate-3.0.1.min.js"></script>
<script src="../../static/js/popper.min.js"></script>
<script src="../../static/js/bootstrap.min.js"></script>
<script src="../../static/js/jquery.easing.1.3.js"></script>
<script src="../../static/js/jquery.waypoints.min.js"></script>
<script src="../../static/js/jquery.stellar.min.js"></script>
<script src="../../static/js/owl.carousel.min.js"></script>
<script src="../../static/js/jquery.magnific-popup.min.js"></script>
<script src="../../static/js/aos.js"></script>
<script src="../../static/js/jquery.animateNumber.min.js"></script>
<script src="../../static/js/scrollax.min.js"></script>
<script
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
<script src="../../static/js/google-map.js"></script>

<script src="../../static/js/main.js"></script>

<script>

	document.addEventListener('DOMContentLoaded', async () => {
        const initialCenterResponse = await fetch('http://localhost:8080/center/getcanters');
        const initialCenterData = await initialCenterResponse.json();
        updateTable(initialCenterData);

        document.getElementById('addCenterForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const centerName = document.getElementById('centerName').value;
            const vaccineType = document.getElementById('vaccineType').value;
            const address = document.getElementById('address').value;
            const contactInfo = document.getElementById('contactInfo').value;

            const newCenterData = {
                centerName,
                vaccineType,
                address,
                contactInfo
            };

            try {
                const response = await fetch('http://localhost:8080/center/addcenter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newCenterData)
                });

                if (response.ok) {
                    console.log('Center added successfully!');
                    const updatedCenterResponse = await fetch('http://localhost:8080/center/getcanters');
                    const updatedCenterData = await updatedCenterResponse.json();
                    updateTable(updatedCenterData);
                    location.reload(); // Refresh the page
                } else {
                    console.error('Error adding center:', response.statusText);
                }
            } catch (error) {
                console.error('Error:', error);
            }

            resetForm();
        });
    });

    function resetForm() {
        document.getElementById('centerName').value = '';
        document.getElementById('vaccineType').value = '';
        document.getElementById('address').value = '';
        document.getElementById('contactInfo').value = '';
    }

    async function deleteCenter(centerId) {
        try {
            const response = await fetch(`http://localhost:8080/center/${centerId}/deletecenter`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                console.log(`Center with ID ${centerId} deleted successfully!`);
                const updatedCenterResponse = await fetch('http://localhost:8080/center/getcanters');
                const updatedCenterData = await updatedCenterResponse.json();
                updateTable(updatedCenterData);
            } else {
                console.error('Error deleting center:', response.statusText);
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }

// Function to prepare the form for editing a center
function prepareEditCenter(centerId) {
    // Set the centerId in the hidden input field
    document.getElementById('centerId').value = centerId;

    // Fetch the current center data and populate the form fields
    fetch(`http://localhost:8080/center/${centerId}/findbyid`)
        .then(response => response.json())
        .then(center => {
            document.getElementById('editCenterName').value = center.centerName;
            document.getElementById('editVaccineType').value = center.vaccineType;
            document.getElementById('editAddress').value = center.address;
            document.getElementById('editContactInfo').value = center.contactInfo;
        })
        .catch(error => console.error('Error:', error));

    // Open the edit modal
    $('#editCenterModal').modal('show');
}


// Function to update the center information
async function updateCenter() {
    // Get the centerId from the hidden input field
    const centerId = document.getElementById('centerId').value;
    const updatedCenterName = document.getElementById('editCenterName').value;
    const updatedVaccineType = document.getElementById('editVaccineType').value;
    const updatedAddress = document.getElementById('editAddress').value;
    const updatedContactInfo = document.getElementById('editContactInfo').value;

    const updatedCenterData = {
        centerId,
        centerName: updatedCenterName,
        vaccineType: updatedVaccineType,
        address: updatedAddress,
        contactInfo: updatedContactInfo
    };

    try {
        // Send the updated center data to the server
        const response = await fetch(`http://localhost:8080/center/${centerId}/updatecenter`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedCenterData)
        });

        if (response.ok) {
            console.log(`Center with ID ${centerId} updated successfully!`);
            // Fetch the updated list of centers
            const updatedCenterResponse = await fetch('http://localhost:8080/center/getcenters');
            const updatedCenters = await updatedCenterResponse.json();

            // Update the table with the new data
            updateTable(updatedCenters);
        } else {
            console.error('Error updating center:', response.statusText);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}

// Event listener for the "Save" button in the edit form
document.getElementById('editCenterForm').addEventListener('submit', (event) => {
    event.preventDefault();
    updateCenter();
});


	// Function to update the table with center data
	function updateTable(data) {
		const tableBody = document.getElementById('tableBody');
		tableBody.innerHTML = ''; // Clear existing rows

		data.forEach(center => {
			const row = document.createElement('tr');
			row.innerHTML = `
			<td>${center.centerId}</td>
			<td>${center.centerName}</td>
			<td>${center.vaccineType}</td>
			<td>${center.address}</td>
			<td>${center.contactInfo}</td>
			<td>
				<a href="#editCenterModal" class="edit" data-toggle="modal" onclick="prepareEditCenter(${center.centerId})"><i class="material-icons" data-toggle="tooltip" title="Edit"></i></a>
				<a href="#" class="delete" data-toggle="modal" onclick="deleteCenter(${center.centerId})"><i class="material-icons" data-toggle="tooltip" title="Delete"></i></a>
			</td>
		`;
			tableBody.appendChild(row);
		});
}
</script>


</body>
</html>